# Contributing to Better-Moodle

Thanks for reading this contribution guide! ðŸ˜Š

> [!NOTE]
> This guide is currently still work in progress. Expect changes, especially clarifications to appear here in the future.

> [!TIP]
> Anything unclear? Feel free to ask [@jxn-30](https://github.com/jxn-30) for clarification!

- [Development](#development)
    - [Contribution Workflow](#contribution-workflow)
    - [Bundling](#bundling)
    - [Testing](#testing)
    - [Pre-Commit](#pre-commit)
    - [Commit messages](#commit-messages)
    - [Pull-Requests](#pull-requests)
    - [Changelog](#changelog)
    - [How-Tos](#how-tos)
        - [Adding a new `FeatureGroup`](#adding-a-new-featuregroup)
    - [Calendars](#calendars)
        - [Semesterzeiten](#semesterzeiten)
        - [Events](#events)

## Development

### Contribution Workflow

The basic contribution steps are:

1. clone the repository.
2. run `yarnÂ install` to install all the dependencies.
    - you need to have the node version specified in the file`.nvmrc` installed and enabled.
    - you need to have yarn enabled via `corepack enable`.
3. develop and test. See sections [Bundling](#bundling) and [Testing](#testing).
4. run `yarnÂ runÂ lint:fix` and `yarnÂ runÂ prettier:write` to lint and format. See section [Pre-Commit](#pre-commit).
    1. fix any warnings and errors reported by ESLint before pushing your commits
5. commit using [Conventional Commits][cc]. See section [Commit messages](#commit-messages) for more info.
6. create a Pull-Request.

### Bundling

In order to create a working userscript, the project needs to be bundled. If not existend, create a config for the target moodle instance in the `configs` folder.
Please see the `configs/_config.d.ts` file for reference on how configs need to be defined.

For bundling, simply run `yarn build <config>` where `<config>` is the name of your config file, without the `.json` file extension.
Afterwards you may copy the userscript into your clipboard to paste it into the editor of your userscript manager (On Linux systems using X11, this could for example be achieved by running `cat dist/better-moodle-<config>.user.js | xclip -selection c`).

If you want to lint and prettify the codebase before bundling, you can run `yarn ci <config>` instead.

### Testing

There currently are no automated tests available.
Please always make sure that Better-Moodle works on latest 3 to 4 versions of common browsers (Firefox and chromium based).
You may also want to test Better-Moodle on mobile devices if possible.

> [!IMPORTANT]
> Bundling does not include transpiling or adding polyfills.
> When using new JavaScript / ECMAScript Features, consult [caniuse.com](https://caniuse.com) or the [MDN References](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference).
> Features should be available in the latest devices and browser versions since minimum 6 months.
> This is not tested or checked automatically. It currently is the developers responsibility.

### Pre-Commit

The `package.json` of Better-Moodle includes scripts for formatting (`prettier:write`) and linting (`lint:fix`), the Better-Moodle repository also includes an up-to-date release of [Yarn](https://yarnpkg.com/) package manager.
Please run both scripts with yarn (`yarnÂ runÂ lint:fix` and `yarnÂ runÂ prettier:write`) before committing and also fix any warnings and issues reported by ESLint.

> [!NOTE]
> It is planned to include CI scripts that automatically report ESLint Warnings and Errors.
> Pull Requests that produce ESLint Warnings and Errors or where prettier would produce changes to the codebase will then not be merged until these are resolved.

### Commit messages

Better-Moodle uses [Conventional Commits][cc] in its latest version, which is `1.0.0` at the time of writing.
This ensures that [Release Please][rp] can generate the changelog.
Release Please introduces some additional features such as commit messages that allow to document multiple changes within a single commit.
Please review the docs of Release Please for more information on how to use them.

The use of the `Release-As`-Directive of Release Please is discouraged for use in Better-Moodle main repository.

### Pull-Requests

Your Pull Request should have a meaningful title as well as a content describing the changes introduced by this PR.
There currently is no Pull Request Template available for Better-Moodle.

### Changelog

Please do not manually edit the `CHANGELOG.md` file as the Changelog is generated by [Release Please][rp]

### How-Tos

#### Adding a new `FeatureGroup`

When adding a new `FeatureGroup`, it is important to add it in `src/settingsModal.tsx` to the `groups` constant.
The position within the array determines the position of the fieldset within the settings.

It is also important to import and use the translations in `src/i18n/*/index.ts`, otherwise it will not be recognized as a `FeatureGroup`.

### Calendars

Calendars MUST[^keyword] provide a link that returns an iCalendar ([RFC 5545](https://www.rfc-editor.org/rfc/rfc5545.txt)) string.

#### Semesterzeiten

Every event MUST[^keyword] have the following attributes set:

- `DTSTART`, type `DATE`
- `DTEND`, type `DATE`
- `DESCRIPTION` with the following format, where
    - `<type>` identifies the type of event to e.g. toggle all lecutre periods at once. Public holiday values of `<type>` MUST[^keyword] start with `holiday-`.
    - `<color>` is a [Bootstrap theme color](https://getbootstrap.com/docs/4.6/getting-started/theming/#theme-colors).
    - `<lang>` is a valid language identifier for the moodle instance and `<name>` the translation in this language. Each language MUST[^keyword] get its own line.

```md
@type:<type>
@color:<color>
@name:<lang>:<name>
```

If the event marks a semester, `<type>` is `semester` and the `@color` line may be omitted.

#### Events

TBD

[cc]: https://www.conventionalcommits.org/
[rp]: https://github.com/googleapis/release-please/

[^keyword]: The key words `MUST`, `MUST NOT`, `REQUIRED`, `SHALL`, `SHALL NOT`, `SHOULD`, `SHOULD NOT`, `RECOMMENDED`, `MAY`, and `OPTIONAL` in this document are to be interpreted as described in [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt).
