name: check.yml
on:
    push:
        branches:
            - v2
    pull_request:
        branches:
            - v2

jobs:
    prettier:
        runs-on: ubuntu-latest
        name: ðŸ± Prettier
        steps:
            - name: ðŸ“¥ï¸ checkout
              uses: actions/checkout@v4

            - name: ðŸŽ›ï¸ setup
              uses: ./.github/actions/setup

            - name: ðŸ± run prettier
              run: yarn prettier:write

            - name: ðŸ”¢ count changes
              run: echo "CHANGES_COUNT=$(git status -s | wc -l)" >> $GITHUB_ENV

            - name: âœ… approve prettier result
              if: ${{ env.CHANGES_COUNT == 0 }}
              run: |
                  echo "# âœ… Prettier approves code" >> $GITHUB_STEP_SUMMARY
                  echo "Running prettier on $(echo ${{ github.sha }} | head -c 7) did not result in any changes. ðŸŽ‰" >> $GITHUB_STEP_SUMMARY

            - name: ðŸ–¨ï¸ print diff introduced by prettier
              if: ${{ env.CHANGES_COUNT > 0 }}
              run: git diff

            - name: âš ï¸ warn over prettier result
              if: ${{ env.CHANGES_COUNT > 0 }}
              run: |
                   echo "# âš ï¸ Prettier changed some code" >> $GITHUB_STEP_SUMMARY
                   echo "There were a total of **${{ env.CHANGES_COUNT }}** files affected by running prettier on $(echo ${{ github.sha }} | head -c 7):" >> $GITHUB_STEP_SUMMARY
                   echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
                   git diff --compact-summary >> $GITHUB_STEP_SUMMARY
                   echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
                   echo "For a complete diff introduced by prettier, please see the workflow logs." >> $GITHUB_STEP_SUMMARY
