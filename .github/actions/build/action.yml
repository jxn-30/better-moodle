name: ðŸ— Build

inputs:
    config:
        description: The config to build with
        required: true

runs:
    using: composite
    steps:
        - name: ðŸŽ›ï¸ setup
          uses: ./.github/actions/setup

        - name: ðŸ—ï¸ build Better-Moodle for ${{ inputs.config }}
          run: yarn build ${{ inputs.config }}
          shell: bash

        - name: ðŸ“¤ï¸ upload build
          id: upload
          uses: actions/upload-artifact@v4
          with:
              # hardcoded since closed envs are not allowed in composite actions
              name: better-moodle-${{ inputs.config }}.user.js
              path: dist/better-moodle-${{ inputs.config }}.user.js

outputs:
    digest:
        description: The digest of the uploaded artifact
        value: ${{ steps.upload.outputs.artifact-digest }}
    file:
        description: The filename of the built userscript
        # using an env is not allowed => hardcoded
        value: better-moodle-${{ inputs.config }}.user.js
    dir:
        description: The directory, output files live in
        # using an env is not allowed => hardcoded
        value: fist
